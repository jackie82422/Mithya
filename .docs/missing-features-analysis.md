# Mock Server ç¼ºå¤±åŠŸèƒ½åˆ†æ

## ç¾æœ‰åŠŸèƒ½å›é¡§
âœ… å‹•æ…‹è·¯ç”±åŒ¹é…ï¼ˆPath + HttpMethodï¼‰
âœ… åŸºæ–¼ JsonPath çš„æ¢ä»¶åŒ¹é…
âœ… å„ªå…ˆåºè¦å‰‡è™•ç†
âœ… Response å»¶é²æ¨¡æ“¬
âœ… Request/Response æ—¥èªŒè¨˜éŒ„
âœ… Admin UI ç®¡ç†ä»‹é¢
âœ… Import/Export è¦å‰‡

## ç¼ºå¤±çš„é—œéµåŠŸèƒ½

### 1. è«‹æ±‚åŒ¹é…å¢å¼· ğŸ”´ é«˜å„ªå…ˆç´š

#### 1.1 Headers åŒ¹é…
- **ç¾ç‹€**ï¼šç›®å‰åªèƒ½åŒ¹é… request body
- **ç¼ºå¤±**ï¼šç„¡æ³•æ ¹æ“š Headers é€²è¡ŒåŒ¹é…ï¼ˆå¦‚ Authorization, Content-Type, Custom Headersï¼‰
- **ä½¿ç”¨å ´æ™¯**ï¼š
  - API Key é©—è­‰æ¸¬è©¦
  - ä¸åŒ API ç‰ˆæœ¬åˆ‡æ›ï¼ˆAccept-Version headerï¼‰
  - Content negotiation æ¸¬è©¦

#### 1.2 Query Parameters åŒ¹é…
- **ç¾ç‹€**ï¼šç„¡æ³•åŒ¹é… URL query string
- **ç¼ºå¤±**ï¼šGET è«‹æ±‚çš„åƒæ•¸åŒ¹é…
- **ä½¿ç”¨å ´æ™¯**ï¼š
  ```
  /api/users?status=active&role=admin
  /api/search?q=keyword&page=1
  ```

#### 1.3 Path Parameters åŒ¹é…
- **ç¾ç‹€**ï¼šéœ€è¦å®Œå…¨åŒ¹é… Path
- **ç¼ºå¤±**ï¼šå‹•æ…‹è·¯å¾‘åƒæ•¸æ”¯æ´
- **ä½¿ç”¨å ´æ™¯**ï¼š
  ```
  /api/users/{id}          â†’ /api/users/123
  /api/orders/{orderId}    â†’ /api/orders/ORD-2024-001
  ```

### 2. Response å¢å¼·åŠŸèƒ½ ğŸ”´ é«˜å„ªå…ˆç´š

#### 2.1 Response Template / Dynamic Response
- **ç¾ç‹€**ï¼šResponse body æ˜¯å›ºå®šçš„å­—ä¸²
- **ç¼ºå¤±**ï¼šç„¡æ³•åœ¨ response ä¸­å¼•ç”¨ request çš„å€¼
- **ä½¿ç”¨å ´æ™¯**ï¼š
  ```json
  Request: { "userId": "U123", "name": "ç‹å°æ˜" }
  Response: {
    "userId": "{{request.body.userId}}",
    "message": "Hello {{request.body.name}}",
    "timestamp": "{{now}}"
  }
  ```

#### 2.2 Response è®Šæ•¸èˆ‡å‡½æ•¸
- æ™‚é–“å‡½æ•¸ï¼š`{{now}}`, `{{date}}`, `{{uuid}}`
- éš¨æ©Ÿå‡½æ•¸ï¼š`{{randomInt}}`, `{{randomString}}`
- Request å¼•ç”¨ï¼š`{{request.body.xxx}}`, `{{request.headers.xxx}}`

### 3. Stateful Mockï¼ˆæœ‰ç‹€æ…‹æ¨¡æ“¬ï¼‰ğŸŸ¡ ä¸­å„ªå…ˆç´š

#### 3.1 Scenario / State Machine
- **ç¾ç‹€**ï¼šæ¯æ¬¡è«‹æ±‚éƒ½æ˜¯ç¨ç«‹çš„
- **ç¼ºå¤±**ï¼šç„¡æ³•æ¨¡æ“¬æœ‰ç‹€æ…‹çš„ API æµç¨‹
- **ä½¿ç”¨å ´æ™¯**ï¼š
  ```
  ç¬¬ 1 æ¬¡å‘¼å« /api/order â†’ å›å‚³ "pending"
  ç¬¬ 2 æ¬¡å‘¼å« /api/order â†’ å›å‚³ "processing"
  ç¬¬ 3 æ¬¡å‘¼å« /api/order â†’ å›å‚³ "completed"
  ```

#### 3.2 Call Counter
- è¨˜éŒ„åŒä¸€å€‹ endpoint è¢«å‘¼å«çš„æ¬¡æ•¸
- æ ¹æ“šæ¬¡æ•¸å›å‚³ä¸åŒ response

### 4. Proxy & Fallback ğŸ”´ é«˜å„ªå…ˆç´š

#### 4.1 Default Response
- **ç¾ç‹€**ï¼šè¦å‰‡æœªå‘½ä¸­æ™‚åªèƒ½å›å‚³ 502 Bad Gateway
- **ç¼ºå¤±**ï¼šç„¡æ³•ç‚ºæ¯å€‹ Endpoint è¨­å®šé è¨­å›æ‡‰
- **ä½¿ç”¨å ´æ™¯**ï¼š
  - ä½œç‚º fallback å›æ‡‰
  - ä¸éœ€è¦ç‚ºæ¯å€‹å¯èƒ½çš„è¼¸å…¥éƒ½å»ºç«‹è¦å‰‡
  - ç¯„ä¾‹ï¼šRule 1-3 åŒ¹é…ç‰¹å®šè­‰è™Ÿï¼ŒRule Default åŒ¹é…æ‰€æœ‰å…¶ä»–æƒ…æ³

#### 4.2 Proxy Mode ğŸŸ¡ ä¸­å„ªå…ˆç´š
- **ç¼ºå¤±**ï¼šè¦å‰‡æœªå‘½ä¸­æ™‚ï¼Œç„¡æ³•è½‰ç™¼åˆ°çœŸå¯¦ API
- **ä½¿ç”¨å ´æ™¯**ï¼š
  - éƒ¨åˆ† mockã€éƒ¨åˆ†çœŸå¯¦ API
  - é€æ­¥é·ç§»åˆ° mock ç’°å¢ƒ

#### 4.3 Recording Mode ğŸŸ¡ ä¸­å„ªå…ˆç´š
- **ç¼ºå¤±**ï¼šç„¡æ³•éŒ„è£½çœŸå¯¦ API çš„ request/response
- **ä½¿ç”¨å ´æ™¯**ï¼š
  - è‡ªå‹•ç”¢ç”Ÿ mock è¦å‰‡
  - æ•æ‰çœŸå¯¦ç’°å¢ƒçš„è¡Œç‚º

### 5. æ¸¬è©¦è¼”åŠ©åŠŸèƒ½ ğŸŸ¡ ä¸­å„ªå…ˆç´š

#### 5.1 Request Validation
- **ç¼ºå¤±**ï¼šç„¡æ³•é©—è­‰ request æ ¼å¼
- **ä½¿ç”¨å ´æ™¯**ï¼š
  - JSON Schema é©—è­‰
  - å¿…å¡«æ¬„ä½æª¢æŸ¥
  - å‹åˆ¥æª¢æŸ¥

#### 5.2 Webhook / Callback
- **ç¼ºå¤±**ï¼šMock è¢«å‘¼å«æ™‚ç„¡æ³•ä¸»å‹•é€šçŸ¥
- **ä½¿ç”¨å ´æ™¯**ï¼š
  - æ•´åˆæ¸¬è©¦æ™‚è§¸ç™¼å…¶ä»–å‹•ä½œ
  - Slack/Email é€šçŸ¥

#### 5.3 Chaos Engineering
- **ç¼ºå¤±**ï¼šç„¡æ³•æ¨¡æ“¬ç¶²è·¯å•é¡Œ
- **ä½¿ç”¨å ´æ™¯**ï¼š
  - éš¨æ©Ÿå¤±æ•—ç‡ï¼ˆ10% æ©Ÿç‡å›å‚³ 500ï¼‰
  - éš¨æ©Ÿè¶…æ™‚
  - éƒ¨åˆ†å›æ‡‰ï¼ˆtruncated responseï¼‰

### 6. ç®¡ç†åŠŸèƒ½å¢å¼· ğŸŸ¢ ä½å„ªå…ˆç´š

#### 6.1 ç’°å¢ƒ / Workspace
- **ç¼ºå¤±**ï¼šç„¡æ³•å€åˆ†ä¸åŒç’°å¢ƒçš„è¦å‰‡
- **ä½¿ç”¨å ´æ™¯**ï¼š
  - Dev / SIT / UAT ç’°å¢ƒéš”é›¢
  - ä¸åŒåœ˜éšŠçš„è¦å‰‡éš”é›¢

#### 6.2 æ¬Šé™ç®¡ç†
- **ç¼ºå¤±**ï¼šç„¡é©—è­‰æˆæ¬Šæ©Ÿåˆ¶
- **ä½¿ç”¨å ´æ™¯**ï¼š
  - SDET A åªèƒ½ç®¡ç† ServiceA çš„è¦å‰‡
  - Read-only ä½¿ç”¨è€…

#### 6.3 ç‰ˆæœ¬æ§åˆ¶ / History
- **ç¼ºå¤±**ï¼šè¦å‰‡ä¿®æ”¹ç„¡æ­·å²è¨˜éŒ„
- **ä½¿ç”¨å ´æ™¯**ï¼š
  - è¦å‰‡è®Šæ›´è¿½è¹¤
  - Rollback åˆ°èˆŠç‰ˆæœ¬

#### 6.4 è¦å‰‡ Tag / Category
- **ç¼ºå¤±**ï¼šç„¡æ³•ç‚ºè¦å‰‡åˆ†é¡
- **ä½¿ç”¨å ´æ™¯**ï¼š
  - æŒ‰æƒ…å¢ƒåˆ†é¡ï¼ˆæ­£å¸¸æµç¨‹ã€ç•°å¸¸æµç¨‹ã€é‚Šç•Œæ¸¬è©¦ï¼‰
  - æ‰¹æ¬¡å•Ÿç”¨/åœç”¨æŸé¡è¦å‰‡

### 7. æ•ˆèƒ½èˆ‡ç›£æ§ ğŸŸ¢ ä½å„ªå…ˆç´š

#### 7.1 Metrics & Monitoring
- **ç¼ºå¤±**ï¼šç„¡æ•ˆèƒ½æŒ‡æ¨™
- **å»ºè­°**ï¼š
  - è«‹æ±‚æˆåŠŸç‡
  - å¹³å‡å›æ‡‰æ™‚é–“
  - è¦å‰‡å‘½ä¸­ç‡åˆ†ä½ˆ

#### 7.2 Log ä¿ç•™ç­–ç•¥
- **ç¼ºå¤±**ï¼šLog ç„¡è‡ªå‹•æ¸…ç†æ©Ÿåˆ¶
- **å»ºè­°**ï¼š
  - ä¾æ™‚é–“è‡ªå‹•åˆªé™¤èˆŠ log
  - Log ä¸Šé™è¨­å®š

### 8. API Spec æ•´åˆ ğŸŸ¢ ä½å„ªå…ˆç´š

#### 8.1 OpenAPI / Swagger Import
- **ç¼ºå¤±**ï¼šç„¡æ³•å¾ API æ–‡ä»¶è‡ªå‹•ç”¢ç”Ÿ endpoint
- **ä½¿ç”¨å ´æ™¯**ï¼š
  - å¿«é€Ÿå»ºç«‹ mock éª¨æ¶
  - ç¢ºä¿ mock ç¬¦åˆ spec

#### 8.2 Contract Testing
- **ç¼ºå¤±**ï¼šç„¡æ³•é©—è­‰ response ç¬¦åˆ contract
- **ä½¿ç”¨å ´æ™¯**ï¼š
  - Pact æ•´åˆ
  - Schema validation

---

## å»ºè­°å¯¦ä½œå„ªå…ˆåº

### Phase 1 - MVPï¼ˆæœ€å°å¯è¡Œç‰ˆæœ¬ï¼‰
1. âœ… åŸºæœ¬è·¯ç”±åŒ¹é…
2. âœ… Request body æ¢ä»¶åŒ¹é…
3. âœ… å›ºå®š response
4. âœ… Admin UI
5. ğŸ”´ **Headers åŒ¹é…**
6. ğŸ”´ **Query Parameters åŒ¹é…**
7. ğŸ”´ **Path Parameters åŒ¹é…**

### Phase 2 - å¢å¼·åŒ¹é…èˆ‡ Response
1. ğŸ”´ **Response Templateï¼ˆå‹•æ…‹è®Šæ•¸ï¼‰**
2. ğŸŸ¡ Response å‡½æ•¸åº«ï¼ˆæ™‚é–“ã€éš¨æ©Ÿã€UUIDï¼‰
3. ğŸŸ¡ Stateful Mockï¼ˆåŸºæœ¬ scenarioï¼‰

### Phase 3 - æ¸¬è©¦è¼”åŠ©
1. ğŸŸ¡ Proxy Modeï¼ˆfallback to real APIï¼‰
2. ğŸŸ¡ Request Validation
3. ğŸŸ¡ Recording Mode

### Phase 4 - é€²éšåŠŸèƒ½
1. ğŸŸ¢ ç’°å¢ƒéš”é›¢
2. ğŸŸ¢ æ¬Šé™ç®¡ç†
3. ğŸŸ¢ Chaos Engineering
4. ğŸŸ¢ OpenAPI Import

---

## èˆ‡å…¶ä»– Mock Server æ¯”è¼ƒ

| åŠŸèƒ½ | æœ¬å°ˆæ¡ˆ | WireMock | MockServer | Mountebank |
|------|--------|----------|------------|------------|
| Headers åŒ¹é… | âŒ | âœ… | âœ… | âœ… |
| Query åŒ¹é… | âŒ | âœ… | âœ… | âœ… |
| Path Params | âŒ | âœ… | âœ… | âœ… |
| Response Template | âŒ | âœ… | âœ… | âœ… |
| Stateful | âŒ | âš ï¸ | âœ… | âœ… |
| Proxy Mode | âŒ | âœ… | âœ… | âœ… |
| Admin UI | âœ… | âŒ | âœ… | âŒ |
| DB æŒä¹…åŒ– | âœ… | âŒ | âŒ | âŒ |
| å‹•æ…‹æ›´æ–°è¦å‰‡ | âœ… | âš ï¸ | âœ… | âœ… |

---

## çµè«–

**æœ€éœ€è¦è£œè¶³çš„æ ¸å¿ƒåŠŸèƒ½ï¼ˆPhase 1 è£œå……ï¼‰ï¼š**
1. **Headers åŒ¹é…** - API æ¸¬è©¦åŸºæœ¬éœ€æ±‚
2. **Query Parameters åŒ¹é…** - GET è«‹æ±‚å¿…å‚™
3. **Path Parameters åŒ¹é…** - RESTful API æ¨™æº–
4. **Response Template** - å‹•æ…‹å›æ‡‰åŸºæœ¬éœ€æ±‚

é€™äº›åŠŸèƒ½è£œé½Šå¾Œï¼Œå°±èƒ½æ»¿è¶³ 80% çš„ mock æ¸¬è©¦å ´æ™¯ã€‚
